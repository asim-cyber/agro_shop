{% extends "base.html" %}
{% block content %}
{% load static %}

<style>
  body {
    background-color: #eef1f5;
  }

  .report-container {
    max-width: 1100px;
    margin: 0 auto;
  }

  .card {
    background-color: #fff;
    border: 1px solid #d1d5db;
    border-radius: 10px;
    margin-bottom: 2rem;
  }

  .card-header {
    background-color: #0f1c2e;
    color: #00d084;
    font-weight: 600;
    padding: 1rem 1.5rem;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }

  .card-body {
    padding: 1.5rem;
  }

  /* Chart */
  #monthlySalesChart {
    width: 100%;
    max-height: 350px;
  }

  /* Table */
  table {
    width: 100%;
    border-collapse: collapse;
  }

  thead {
    background-color: #f9fafb;
  }

  th, td {
    border: 1px solid #d1d5db;
    padding: 0.75rem 1rem;
    text-align: center;
    color: #0f1c2e;
  }

  th {
    font-weight: 600;
  }

  tr:hover {
    background-color: #f1f5f9;
  }

  .text-muted {
    color: #6b7280 !important;
  }

  /* Responsive */
  @media (max-width: 768px) {
    table, thead, tbody, th, td, tr { display: block; }
    th { display: none; }
    td {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 1rem;
      border-bottom: 1px solid #d1d5db;
    }
    td::before {
      content: attr(data-label);
      font-weight: 600;
      color: #0f1c2e;
    }
  }
</style>

<div class="container my-5 report-container">
  <!-- Header -->
  <div class="text-center mb-4">
    <h2 class="fw-bold text-dark">ðŸ“Š Monthly Reports</h2>
    <p class="text-muted">Overview of monthly sales, customers, and cash payments.</p>
  </div>

  <!-- Chart -->
  <div class="card">
    <div class="card-header">ðŸ“ˆ Monthly Sales Chart</div>
    <div class="card-body">
      <canvas id="monthlySalesChart"></canvas>
    </div>
  </div>

  <!-- Table -->
  <div class="card">
    <div class="card-header">ðŸ§¾ Monthly Summary</div>
    <div class="card-body p-0">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Total Customers</th>
            <th>Total Quantity</th>
            <th>Grand Total (Rs.)</th>
            <th>Total Cash Payment (Rs.)</th>
          </tr>
        </thead>
        <tbody>
          {% if monthly_summary %}
            {% for month, data in monthly_summary.items %}
            <tr>
              <td data-label="Date">{{ month }}</td>
              <td data-label="Total Customers">{{ data.total_customers }}</td>
              <td data-label="Total Quantity">{{ data.total_quantity }}</td>
              <td data-label="Grand Total">{{ data.grand_total }}</td>
              <td data-label="Total Cash Payment">{{ data.cash_payment }}</td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="text-center text-muted py-3">No Monthly Reports Available</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('monthlySalesChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ months|safe }},
      datasets: [{
        label: 'Monthly Sales Reports',
        data: {{ sales_data|safe }},
        borderColor: '#00d084',
        backgroundColor: 'rgba(0, 208, 132, 0.15)',
        borderWidth: 2,
        fill: true,
        tension: 0.3,
        pointBackgroundColor: '#00d084',
        pointRadius: 4,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: 'Monthly Sales Reports',
          color: '#1e293b',
          font: { size: 14, weight: 'bold' }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { color: '#1e293b' },
          grid: { color: '#e5e7eb' }
        },
        x: {
          ticks: { color: '#1e293b' },
          grid: { color: '#f3f4f6' }
        }
      }
    }
  });
</script>

{% endblock %}
